<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>JS跨域问题的总结归纳</title>
  <meta name="description" content="如何解决跨域问题">
  <meta name="author" content="Tingyue Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="JS跨域问题的总结归纳">
  <meta name="twitter:description" content="如何解决跨域问题">

  <meta property="og:type" content="article">
  <meta property="og:title" content="JS跨域问题的总结归纳">
  <meta property="og:description" content="如何解决跨域问题">

  <link rel="icon" type="image/x-icon" href="/myblog/assets/images/favicon.ico"/>
  <link href="/myblog/assets/images/favicon.ico" rel="shortcut icon" type="image/x-icon">

  <link rel="stylesheet" href="/myblog/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/myblog/js/prettify/atelier-lakeside-light.min.css">
  <link rel="canonical" href="http://woodghost.github.io/myblog/2017/04/js-cross-origin/">
  <link rel="alternate" type="application/rss+xml" title="WoodGhost" href="http://woodghost.github.io/myblog/feed.xml">

  <meta name="google-site-verification" content="" />

</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/myblog/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/myblog/" title="goto WoodGhost" class="blog-button"><img src="/myblog/assets/images/avatar.jpg" width="80" alt="WoodGhost logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/myblog/#blog" title="link to homepage for WoodGhost" class="blog-button">WoodGhost</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">渡頭余落日 墟里上孤煙</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Technical discuss & Poems & Offshore Fantasy</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        
        <p class="panel-cover__description">收藏整理归纳的清凉小角落...Welcome to this world :)</p>
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/myblog/#blog" title="博客" class="blog-button">打开 Blog</a></li>
                
              </ul>
            </nav>
          </div>

          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/2576328977" title="@2576328977 weibo" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/woodghost" title="@woodghost Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/woodghost36" title="@woodghost36" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  
  <!-- instagram -->
  <li class="navigation__item">
    <a href="http://www.instagram.com/woodghost.io" title="@woodghost.io" target="_blank">
      <i class='social fa fa-instagram'></i>
      <span class="label">Instagram</span>
    </a>
  </li>
  

  


  

  <!-- RSS -->
  <!--<li class="navigation__item">-->
    <!--<a href="/myblog/feed.xml" rel="author" title="RSS" target="_blank">-->
      <!--<i class='social fa fa-rss'></i>-->
      <!--<span class="label">RSS</span>-->
    <!--</a>-->
  <!--</li>-->

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:woodghost0960@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>

    
    <div class="panel-cover--overlay cover-blue"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-04-01 15:43:24 +0800" itemprop="datePublished" class="post-meta__date date">2017-04-01</time> &#8226; <span class="post-meta__tags tags">javascript</span>
    </div>
    <h1 class="post-title">JS跨域问题的总结归纳</h1>
  </header>

  <section class="post">
    <h4 id="section">如何解决跨域问题</h4>

<blockquote>
  <p>JSONP：</p>
</blockquote>

<p>原理是：动态插入<code class="highlighter-rouge">script</code>标签，通过<code class="highlighter-rouge">script</code>标签引入一个<code class="highlighter-rouge">js</code>文件，这个js文件载入成功后会执行我们在url参数中指定的函数，并且会把我们需要的<code class="highlighter-rouge">json</code>数据作为参数传入。</p>

<p>由于同源策略的限制，<code class="highlighter-rouge">XmlHttpRequest</code>只允许请求当前源（域名、协议、端口）的资源，为了实现跨域请求，可以通过<code class="highlighter-rouge">script</code>标签实现跨域请求，然后在服务端输出JSON数据并执行回调函数，从而解决了跨域的数据请求。</p>

<p>优点是兼容性好，简单易用，支持浏览器与服务器双向通信。缺点是只支持GET请求。</p>

<p><code class="highlighter-rouge">JSONP</code>：<code class="highlighter-rouge">json+padding</code>（内填充），顾名思义，就是把JSON填充到一个盒子里</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">function</span> <span class="nx">createJs</span><span class="p">(</span><span class="nx">sUrl</span><span class="p">){</span>

        <span class="kd">var</span> <span class="nx">oScript</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span>
        <span class="nx">oScript</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">'text/javascript'</span><span class="p">;</span>
        <span class="nx">oScript</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">sUrl</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'head'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">oScript</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">createJs</span><span class="p">(</span><span class="s1">'jsonp.js'</span><span class="p">);</span>

    <span class="nx">box</span><span class="p">({</span>
       <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'test'</span>
    <span class="p">});</span>

    <span class="kd">function</span> <span class="nx">box</span><span class="p">(</span><span class="nx">json</span><span class="p">){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre>
</div>

<blockquote>
  <p>CORS cross-origin resource share</p>
</blockquote>

<p>服务器端对于<code class="highlighter-rouge">CORS</code>的支持，主要就是通过设置<code class="highlighter-rouge">Access-Control-Allow-Origin</code>来进行的。如果浏览器检测到相应的设置，就可以允许<code class="highlighter-rouge">Ajax</code>进行跨域的访问。</p>

<p>了解更多可以看 <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS wiki</a></p>

<blockquote>
  <p>通过修改document.domain来跨子域</p>
</blockquote>

<p>将子域和主域的<code class="highlighter-rouge">document.domain</code>设为同一个主域.前提条件：这两个域名必须属于同一个基础域名!而且所用的协议，端口都要一致，否则无法利用<code class="highlighter-rouge">document.domain</code>进行跨域</p>

<p>主域相同的使用<code class="highlighter-rouge">document.domain</code></p>

<blockquote>
  <p>使用window.name来进行跨域</p>
</blockquote>

<p><code class="highlighter-rouge">window</code>对象有个<code class="highlighter-rouge">name</code>属性，该属性有个特征：即在一个窗口(window)的生命周期内,窗口载入的所有的页面都是共享一个<code class="highlighter-rouge">window.name</code>的，每个页面对<code class="highlighter-rouge">window.name</code>都有读写的权限，<code class="highlighter-rouge">window.name</code>是持久存在一个窗口载入过的所有页面中的</p>

<blockquote>
  <p>使用HTML5中新引进的<code class="highlighter-rouge">window.postMessage</code>方法来跨域传送数据</p>
</blockquote>

<p>还有flash、在服务器上设置代理页面等跨域方式。个人认为<code class="highlighter-rouge">window.name</code>的方法既不复杂，也能兼容到几乎所有浏览器，这真是极好的一种跨域方法</p>


  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">Latest Post</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/04/js-fetchapi/" title="link to fetch API与Promise">fetch API与Promise</a></h2>
       <p class="excerpt">  参考自 https://developer.mozilla.org/en/docs/Web/API/Fetch_API转载自 https://hacks.mozilla.org/2015/03/this-api-is-so-fetchinghttp://bubkoo.com/2015/05/08/introduction-to-fetch/https://davidwalsh.name/fetchJavaScript 通过XMLHttpRequest(XHR)来执行异步请求，这个方式已...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-04-13 15:43:24 +0800" class="post-list__meta--date date">2017-04-13</time> &#8226; <span class="post-list__meta--tags tags">javascript,fetchAPI</span><a class="btn-border-small" href=/myblog/2017/04/js-fetchapi/>More...</a></div>
   </div>
   

   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">Earlier Post</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/03/js-modules/" title="link to JS模块化标准的总结归纳">JS模块化标准的总结归纳</a></h2>
       <p class="excerpt">RequireJS implements the AMD API CommonJS是一种规范 以下是玉伯对这几种不同的模块化规范的解释  作者：玉伯链接：https://www.zhihu.com/question/20351507/answer/14859415来源：知乎AMD 是 RequireJS 在推广过程中对模块定义的规范化产出。CMD 是 SeaJS 在推广过程中对模块定义的规范化产出。类似的还有 CommonJS Modules/2.0 规范，是 BravoJS 在推广过程中...&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-03-31 15:43:24 +0800" class="post-list__meta--date date">2017-03-31</time> &#8226; <span class="post-list__meta--tags tags">javascript,module</span><a class="btn-border-small" href=/myblog/2017/03/js-modules/>More...</a></div>
   </div>
   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>

    var disqus_config = function () {
        this.page.url = "http://woodghost.github.io/myblog/2017/04/js-cross-origin/";
        this.page.identifier = "/2017/04/js-cross-origin/";
    };

    var disqus_shortname = 'woodghost';

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>When checking<a href="http://disqus.com/?ref_noscript"> Disqus </a>comment, pls enable JavaScript</noscript>

  



</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">Site adopted <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Attribution-NonCommercial-ShareAlike 4.0 Internationa</a></span>
        <span class="footer__copyright">Generated by <a href="https://jekyllrb.com">Jekyll</a> at 2017-05-05, acknowledgement: <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> for VPS service</span>
        <span class="footer__copyright">Created by  <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> Here is <a href="https://github.com/onevcat/OneV-s-Den">Source code</a> - &copy; 2017</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<!--<script type="text/javascript" src="/myblog/js/highlight.pack.js"</script>-->
<!--<script>hljs.initHighlightingOnLoad();</script>-->

<script src="/myblog/js/prettify/prettify.js"></script>
<script type="text/javascript">
    $(function(){
        $("pre").addClass("prettyprint linenums");
        prettyPrint();
    });
</script>

<script type="text/javascript" src="/myblog/js/main.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-81484538-1', '');
    ga('send', 'pageview');
</script>


    
  </body>

</html>
