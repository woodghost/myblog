<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>JS深拷贝浅拷贝问题</title>
  <meta name="description" content="浅拷贝只是复制引用(Reference)，拷贝后，a.obj === b.obj">
  <meta name="author" content="Tingyue Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="JS深拷贝浅拷贝问题">
  <meta name="twitter:description" content="浅拷贝只是复制引用(Reference)，拷贝后，a.obj === b.obj">

  <meta property="og:type" content="article">
  <meta property="og:title" content="JS深拷贝浅拷贝问题">
  <meta property="og:description" content="浅拷贝只是复制引用(Reference)，拷贝后，a.obj === b.obj">

  <link rel="icon" type="image/x-icon" href="/myblog/assets/images/favicon.ico"/>
  <link href="/myblog/assets/images/favicon.ico" rel="shortcut icon" type="image/x-icon">

  <link rel="stylesheet" href="/myblog/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="/myblog/js/prettify/atelier-lakeside-light.min.css">
  <link rel="canonical" href="http://woodghost.github.io/myblog/2017/03/js-copy/">
  <link rel="alternate" type="application/rss+xml" title="WoodGhost" href="http://woodghost.github.io/myblog/feed.xml">

  <meta name="google-site-verification" content="" />

</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/myblog/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/myblog/" title="goto WoodGhost" class="blog-button"><img src="/myblog/assets/images/avatar.jpg" width="80" alt="WoodGhost logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/myblog/#blog" title="link to homepage for WoodGhost" class="blog-button">WoodGhost</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">渡頭余落日 墟里上孤煙</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Technical discuss & Poems & Offshore Fantasy</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        
        <p class="panel-cover__description">This place is for little ghost and her fellows to read, write and learn. Welcome to this world :)</p>
        

        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/myblog/#blog" title="博客" class="blog-button">Blog</a></li>
                
                  <li class="navigation__item"><a href="http://woodghost.github.io/" target="_blank" title="cv">About Me</a></li>
                
              </ul>
            </nav>
          </div>

          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/2576328977" title="@2576328977 weibo" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/woodghost" title="@woodghost Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  

  
  <!-- Twitter -->
  <li class="navigation__item">
    <a href="http://twitter.com/woodghost36" title="@woodghost36" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>
  

  
  <!-- instagram -->
  <li class="navigation__item">
    <a href="http://www.instagram.com/woodghost.io" title="@woodghost.io" target="_blank">
      <i class='social fa fa-instagram'></i>
      <span class="label">Instagram</span>
    </a>
  </li>
  

  


  
  <!-- Google Plus -->
  <li class="navigation__item">
    <a href="https://plus.google.com/117752045392286741953" rel="author" title="Google+" target="_blank">
      <i class='social fa fa-google-plus-square'></i>
      <span class="label">Google Plus</span>
    </a>
  </li>
  

  <!-- RSS -->
  <!--<li class="navigation__item">-->
    <!--<a href="/myblog/feed.xml" rel="author" title="RSS" target="_blank">-->
      <!--<i class='social fa fa-rss'></i>-->
      <!--<span class="label">RSS</span>-->
    <!--</a>-->
  <!--</li>-->

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:woodghost0960@gmail.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>

    
    <div class="panel-cover--overlay cover-blue"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-03-31 14:43:36 +0800" itemprop="datePublished" class="post-meta__date date">2017-03-31</time> &#8226; <span class="post-meta__tags tags">javascript</span>
    </div>
    <h1 class="post-title">JS深拷贝浅拷贝问题</h1>
  </header>

  <section class="post">
    <p>浅拷贝只是复制引用(Reference)，
拷贝后，<code class="highlighter-rouge">a.obj === b.obj</code></p>

<p>深拷贝是创建(clone)了一个“一模一样”的对象，并保存在<code class="highlighter-rouge">a.obj中，所以 a.obj !== b.obj</code></p>

<blockquote>
  <p>ps:对于引用类型，===运算符当左值和右值是同一个对象，也就是内存地址相同时返回true。</p>
</blockquote>

<p>ES6之后，有很方便的浅copy方法
<code class="highlighter-rouge">
var obj = { a: 1 };
var copy = Object.assign({}, obj);
console.log(copy); // { a: 1 }
</code></p>

<p>实现es5版本的Object.assign：
&gt; 来自 https://cnodejs.org/topic/56c49662db16d3343df34b13</p>

<p>实现步骤：</p>

<ol>
  <li>判断是否原生支持该函数，如果不存在的话创建一个立即执行函数，该函数将创建一个assign函数绑定到Object上。</li>
  <li>判断参数是否正确(目的对象不能为空，我们可以直接设置{}传递进去,但必须设置该值)
使用Object在原有的对象基础上返回该对象，并保存为out</li>
  <li>使用for…in循环遍历出所有的可枚举的自有对象。并复制给新的目标对象(hasOwnProperty返回非原型链上的属性)</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>if (typeof Object.assign != 'function') {
  (function () {
	Object.assign = function (target) {
	 'use strict';
	 if (target === undefined || target === null) {
	   throw new TypeError('Cannot convert undefined or null to object');
	 }

	 var output = Object(target);
	 for (var index = 1; index &lt; arguments.length; index++) {
	   var source = arguments[index];
	   if (source !== undefined &amp;&amp; source !== null) {
	     for (var nextKey in source) {
	       if (source.hasOwnProperty(nextKey)) {
	         output[nextKey] = source[nextKey];
	       }
	     }
	   }
	 }
	 return output;
	};
})();
}
</code></pre>
</div>

<p>深拷贝</p>

<div class="highlighter-rouge"><pre class="highlight"><code>b = JSON.parse( JSON.stringify(a) )
</code></pre>
</div>

<p>局限性：</p>

<ul>
  <li>
    <p>能正确处理的对象只有 Number, String, Boolean, Array, 扁平对象，即那些能够被 json 直接表示的数据结构。</p>
  </li>
  <li>无法复制函数</li>
  <li>原型链没了，对象就是object，所属的类没了。</li>
</ul>

<p>知乎上一位作者对js拷贝问题的解答以及他的另一篇文章
https://www.zhihu.com/question/23031215</p>

<p><a href="https://segmentfault.com/a/1190000002801042">深入剖析js深拷贝</a>!</p>


  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">Latest Post</span>
       <h2 class="post-list__post-title post-title"><a href="/2017/03/last-day-march/" title="link to 三月的最后一天">三月的最后一天</a></h2>
       <p class="excerpt">白驹过隙，四月将至，收拾行囊，重新开始借此机会将以往笔记整理成blogs按时间顺序陆续贴出，包括新近看到的学习笔记&hellip;</p>
       <div class="post-list__meta"><time datetime="2017-03-31 15:32:24 +0800" class="post-list__meta--date date">2017-03-31</time> &#8226; <span class="post-list__meta--tags tags">life,mood</span><a class="btn-border-small" href=/myblog/2017/03/last-day-march/>More...</a></div>
   </div>
   

   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">Earlier Post</span>
       <h2 class="post-list__post-title post-title"><a href="/2016/08/leetcode-01/" title="link to 第一篇Leetcode学习笔记">第一篇Leetcode学习笔记</a></h2>
       <p class="excerpt">First of all, 看了最最基本的leetcode 371 和 001都是两个数求和这种，诚然，可以直接return a + b, 但是大部分公司显然不会满足这种答案。所以借此机会认真复习了bit manipulation，two’s complement等二进制位运算方面的知识。编码尽量采用c++, javascript, pythontwo’s complement补码About binary还有关于2进制，位运算什么的Two’s complement is the way e...&hellip;</p>
       <div class="post-list__meta"><time datetime="2016-08-03 18:06:24 +0800" class="post-list__meta--date date">2016-08-03</time> &#8226; <span class="post-list__meta--tags tags">algorithm</span><a class="btn-border-small" href=/myblog/2016/08/leetcode-01/>More...</a></div>
   </div>
   
</section>

<section class="post-comments">
  
    <div id="disqus_thread"></div>
    <script>

    var disqus_config = function () {
        this.page.url = "http://woodghost.github.io/myblog/2017/03/js-copy/";
        this.page.identifier = "/2017/03/js-copy/";
    };

    var disqus_shortname = 'woodghost';

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>When checking<a href="http://disqus.com/?ref_noscript"> Disqus </a>comment, pls enable JavaScript</noscript>

  



</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">Site adopted <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Attribution-NonCommercial-ShareAlike 4.0 Internationa</a></span>
        <span class="footer__copyright">Generated by <a href="https://jekyllrb.com">Jekyll</a> at 2017-04-13, acknowledgement: <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> for VPS service</span>
        <span class="footer__copyright">Created by  <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> Here is <a href="https://github.com/onevcat/OneV-s-Den">Source code</a> - &copy; 2017</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<!--<script type="text/javascript" src="/myblog/js/highlight.pack.js"</script>-->
<!--<script>hljs.initHighlightingOnLoad();</script>-->

<script src="/myblog/js/prettify/prettify.js"></script>
<script type="text/javascript">
    $(function(){
        $("pre").addClass("prettyprint linenums");
        prettyPrint();
    });
</script>

<script type="text/javascript" src="/myblog/js/main.js"></script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-81484538-1', '');
    ga('send', 'pageview');
</script>


    
  </body>

</html>
